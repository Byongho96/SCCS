<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.scss.api.mypage.mapper.MypageMapper">


  <resultMap id="submissionWithProblemAboutUser" type="hashmap">
    <result column="problem_title" property="problemTitle"></result>
    <result column="problem_answerRate" property="problemAnswerRate"></result>
    <result column="submit_datetime" property="submitDatetime"></result>
    <result column="difficulty" property="difficulty"></result>
    <result column="language_id" property="languageId"></result>
  </resultMap>

  <resultMap id="studyroomWithProblem" type="hashmap">
    <result column="studyroom_title" property="studyroomTitle"></result>
    <result column="studyroom_create_datetime" property="studyroomCreateDatetime"></result>
    <result column="problem_title" property="problemTitle"></result>
  </resultMap>

  <select id="getHistory">
    select sr.title, sr.create_datetime, p.name from studyroom sr, problem p, studyroom_member sm,
    member m, studyroom_problem sp where
    DATE(sr.create_datetime) between m.joinDate and
    DATE_FORMAT(concat(#{year},'-',#{month}),'%Y-%M') and sm.member_id = #{memberId} sm.studyroom_id
    = sr.id and m.id = sm.member_id and sp.problem_id = p.id and sp.studyroom_id =
    sr.id;
  </select>

  <select id="getHistoryDetail">
    sr.title , p.name s.code , s.runtime, s.memory, s.result, s.submit_datetime, s.problem_id,
    s.member_id, s.language_id
    from studyroom sr, problem p, submission s
    where sr.id = #{studyId}
    order by s.member_id;
  </select>

  <select id="getProblems" parameterType="hashmap" resultMap="submissionWithProblemAboutUser">
    SELECT p.name ,p.accepted_number/p.submission_number*100 as 'hello'
    ,s.submit_datetime,p.difficulty,s.language_id
    FROM problem p, submission s
    WHERE p.id = s.problem_id AND s.member_id = #{memberId};
  </select>


</mapper>